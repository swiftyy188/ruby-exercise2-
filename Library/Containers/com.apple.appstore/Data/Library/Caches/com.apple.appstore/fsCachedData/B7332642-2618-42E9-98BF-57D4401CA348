/*
** Copyright Â© 2015 Apple Inc.
** All rights reserved.
*/

its.client.platformShortName="DA",its.client.platformIsDT=!1,its.client.platformIsDA=!0,its.client.platformIsK2=!1,its.client.platformIsP2=!1,its.client.screenReaderRunning=function(){return its.screenReaderRunning},its.client.getUserDSID=function(){if(its.client.isRunning){var e=iTunes.primaryAccount;
if(e!=null)return e.dsID}return null},its.client.doDialogWithDict=function(e,t){var n=e.cloneNode(!0),r=document.implementation.createDocument(null,"",null);
r.appendChild(n);
var i=(new XMLSerializer).serializeToString(r);
if(its.client.isClientGreaterThanOrEqualToSpecifiedVersion("1.0.1")){var s=function(e){var n=!1;
return t&&(e.clickedButton=="1"?t.okButtonAction&&(n=t.okButtonAction(e)):e.clickedButton=="2"?t.cancelButtonAction&&(n=t.cancelButtonAction(e)):e.clickedButton=="3"?t.otherButtonAction&&(n=t.otherButtonAction(e)):e.clickedButton=="4"),n};
iTunes.doDialogXML(i,s)}else t&&(t.okButtonAction||t.cancelButtonAction||t.otherButtonAction)&&its.client.debug("dialog callbacks are not supported in App Store 1.0 !!"),i="<dict><key>dialog</key>"+i+"</dict>",iTunes.addProtocol(i)},its.client.putURLOnPasteboard=function(e){iTunes.putTextOnPasteboard(e)},its.client.startProgressSpinner=function(){its.client.isRunning&&(its.client._progressSpinnerCount?its.client._progressSpinnerCount++:its.client._progressSpinnerCount=1,iTunes.startProgressSpinner())},its.client.stopProgressSpinner=function(e){if(its.client.isRunning){its.client._progressSpinnerCount?its.client._progressSpinnerCount--:console.log("its.client.stopProgressSpinner: you should call startProgressSpinner first");
if(its.client._progressSpinnerCount<1||e)iTunes.stopProgressSpinner(),its.client._progressSpinnerCount=0}},its.client.appIsEligibleForAdoption=function(e){return!its.client.isRunning||!iTunes.appIsEligibleForAdoption?(its.client.showAlert("App adoption is not supported in this version."),!1):iTunes.appIsEligibleForAdoption(e)},its.client.adoptionCompleted=function(e){return!its.client.isRunning||!iTunes.adoptionCompleted?(its.client.showAlert("App adoption is not supported in this version."),!1):iTunes.adoptionCompleted(e)},its.client.adopt=function(e,t){if(!(!its.client.isRunning||its.string.compareNumerically(its.client.version(),"1.1.1")<0))return iTunes.adopt(e,t);
its.client.showAlert("App adoption is not supported in this version."),t()},its.client.claimAllEligibleApps=function(e){if(its.client.isRunning&&its.isFunction(iTunes.claimUpToDateApps)){var t=iTunes.eligibleUpToDateApps();
return iTunes.claimUpToDateApps(t,t,e)}},its.client.appIsEligibleForAdoption=function(e){var t=!1;
return its.client.isRunning&&its.isFunction(iTunes.appIsEligibleForAdoption)&&(t=iTunes.appIsEligibleForAdoption(e),t&&its.string.compareNumerically(its.client.version(),"1.2")<0&&iTunes.adoptionCompleted(e)&&(t=!1)),t},its.client.appIsEligibleForGratis=function(e){var t=!1;
return its.client.isRunning&&its.isFunction(iTunes.eligibleUpToDateApps)&&(t=iTunes.eligibleUpToDateApps().indexOf(e)!=-1),t},its.client.authenticate=function(e,t,n,r,i){var s=function(t){if(!e)return;t.result=="success"&&typeof e=="function"?e.apply({},[t]):t.result=="success"&&typeof e.onSuccess=="function"?e.onSuccess.apply({},[t]):t.result=="cancel"&&typeof e.onCancel=="function"&&e.onCancel.apply({},[t])};
console.log("authenticating "+iTunes.primaryAccount.dsID),optionObject={completionCallback:s,dialog:{message:t,explanation:n,okButtonString:its.loc("SignIn"),cancelButtonString:its.loc("Cancel")}},r&&(optionObject.additionalQueryParameters="createSession=true"),i&&(optionObject.forced=i),console.dir(optionObject),iTunes.authenticateForAccount(iTunes.primaryAccount,optionObject)},its.client.version=function(){var e=iTunes.version;
return e===undefined&&(e="1.0"),e},its.client.osVersion=function(){var e=iTunes.systemVersion();
return e===undefined&&(e="10.6.7"),e},its.client.switchStorefront=function(e){its.client.log("Switching to storefront: "+e),iTunes.signOut(),iTunes.setStorefront(e),iTunes.reset()},its.client.platformIsWindows=function(){return!1},its.kit.onPreload(function(){if(its.client.isRunning){var e=document.getElementById("protocol");
e&&iTunes.addProtocol(e.textContent)}}),its.kit.createController("iTSDADisableHistory",{controller:{preload:function(){if(!its.client.isRunning)return;var e=document.body.getBooleanAttribute("disable-history-and-navigation"),t=document.body.getBooleanAttribute("disable-navigation"),n=document.body.getBooleanAttribute("disable-history");
(e||t)&&iTunes.setHistoryNavigationEnabled(!1),(e||n)&&iTunes.getHistory().removeCurrentPage()}}}),its.kit.createController("ITSDAToolbar",{controller:{preload:function(){if(!its.client.isRunning)return;if(document.body&&document.body.hasAttribute("toolbar-selection")){var e=document.body.getAttribute("toolbar-selection");
e&&iTunes.selectToolbarItem(e)}else iTunes.selectToolbarItem(null)}}}),its.kit.createController("iTSValidation",{binding:"body.account form, body.redeem form",controller:{ignoreCCValidation:function(){this._components.each(function(e){e.ignoreCCValidation()})},restoreCCValidation:function(){this._components.each(function(e){e.restoreCCValidation()})},setHiddenValue:function(){this._components.each(function(e){e.setHiddenValue()})},hasModified:function(){var t=!1;
return this._components.each(function(e){e.userModified&&(t=!0)}),t}},component:{init:function(){this.isEditAccount=this.element.querySelector("section.edit-account"),this.isEditBilling=this.element.querySelector("section.edit-billing"),this.errorContainer=this.element.querySelector(".page-error"),this.isRedeem=this.element.querySelector("section.redeem-content"),this.isManageNickname=this.element.querySelector("section.change-nickname"),this.isPrepaidMoney=this.element.querySelector("section.prepaid-addmoney"),this.isSecondaryAuth=this.element.querySelector("section.secondary-auth"),this.isHarvesting=this.element.querySelector("section.account-harvesting"),this.userModified=!1,this.firstLoad=!0;
if(this.isEditAccount||this.isEditBilling||this.isRedeem||this.isManageNickname||this.isPrepaidMoney||this.isSecondaryAuth||this.isHarvesting)this.inputs=this.element.querySelectorAll("input, select, button"),this.ccInputs=this.element.querySelectorAll("div.payment-info input:not(.optional), div.payment-info select:not(.optional), div.payment-info button:not(.optional)"),this.errorStrings={amount:"JS.errors.selectAmount",bankCardType:"JS.errors.selectBankCard","continue":"JS.errors.requiredLite",salutation:"JS.errors.noTitle",emailAddress:"JS.errors.email",pass1:"JS.DTHEditAccount.PasswordNotValid",pass2:"JS.DTHEditAccount.password.doesNotMatch",question:"JS.MZFinance.PopulateDSChallengeInformation.QuestionError",answer:"JS.errors.answer",birthYear:"JS.errors.intBirthYear",year:"JS.Year"},this.errorContainer=this.element.querySelector("ul.page-error"),this.errorContainer&&(this.element.addEventListener("submit",this,!0),this.assignType(),this.errorCheck());
this.firstLoad=!1,window.validateOnLoad&&this.formCheck()},blurEvent:function(e){e.target.removeEventListener("change"),e.target.removeEventListener("keyup"),this.doTheRinger(e.target)},clickEvent:function(e){var t=this.formCheck();
t||e.preventDefault();
if(this.isEditBilling&&e.target==this.continueButton){var n=this.element.querySelector("div.billing-information.paypal");
if(n){var r=document.getElementById("paypallink").href;
iTunes.openURL(r),e.preventDefault()}}},focusEvent:function(e){this.clearError(e.target)},keypressEvent:function(e){e.keyCode==13&&(e.preventDefault(),e.stopPropagation(),this.continueButton.click())},submitEvent:function(e){},hasChanged:function(e,t){this.toValidate[e.id]=t,this.firstLoad||(this.userModified=!0)},hasModified:function(){return this.userModified},assignType:function(e){var t=this;
t.lookup=[],t.toValidate={},t.inputElement={},this.inputs.each(function(e){if(e.id&&!e.hasClassName("optional")&&e.type!="submit"){if(e.id.match("nucaptcha")||e.id.match("ndw")||e.id.match("ndpd")||e.id.match("lmsubmitted"))return;t.lookup.push(e),t.toValidate[e.id]=!0,t.inputElement[e.id]=e,e.type!="submit"&&e.type!="hidden"&&(t.listen(e,"focus","focusEvent",!0),t.listen(e,"blur","blurEvent",!0),t.listen(e,"keypress","keypressEvent",!0),e.id&&e.value!=""&&e.value!="WONoSelectionString"&&t.hasChanged(e,!1),(e.type=="text"||e.type=="email"||e.type=="password")&&t.listenForEnterKey(e),e.id=="pass2"&&t.enableVerifyPassword(e))}else e.type=="submit"?e.hasClassName("continue")&&(t.continueButton=e,t.listen(e,"click","clickEvent",!0)):(t.listen(e,"focus","focusEvent",!0),t.listen(e,"keypress","keypressEvent",!0))})},doTheRinger:function(e){this.hasChanged(e,!1),this.clearError(e,!0);
if(e.value==""||e.value=="WONoSelectionString")this.hasChanged(e,!0),e.id=="pass1"&&this.enableVerifyPassword(e);
else{if(e.hasAttribute("pattern")){var t=e.getAttribute("pattern"),n=e.value.match(t)?e.value.match(t)[0]:null;
if(!n||e.value!=n)this.throwError(e,!0),this.hasChanged(e,!0)}e.type=="password"&&e.id=="pass2"&&this.inputElement.pass1.value!=this.inputElement.pass2.value&&(this.throwError(this.inputElement.pass2,!0),this.hasChanged(e,!0))}},numberOfErrors:function(){var e=this,t=0;
return this.inputs.each(function(n){e.toValidate[n.id]&&(t+=1)}),t},throwError:function(e,t){e.hasClassName("error")||(e.addClassName("error"),e.id!=""&&this.appendError(e.id))},appendError:function(e){var t=this.errorStrings[e];
if(t){if(typeof t=="string")var n=its.loc(t);
else var r=its.loc(t[1]),n=its.loc(t[0],{0:r});
if(n){this.errorContainer.parentNode.hasClassName("visible")||this.errorContainer.parentNode.addClassName("visible");
if(this.errorContainer["error-"+e]){var i=this.errorContainer.querySelector("#error-"+e);
i?this.errorContainer["error-"+e].removeClassName("hide"):(this.errorContainer.appendChild(this.errorContainer["error-"+e]),i=this.errorContainer.querySelector("#error-"+e)),defer(this,function(){i.style.opacity=1})}else if(this.errorContainer.querySelector("#error-"+e)){var s=this.errorContainer.querySelector("#error-"+e);
s.removeClassName("hide"),defer(this,function(){s.style.opacity=1})}else{var o=document.createElement("li"),u=document.createElement("span");
o.id="error-"+e,u.innerHTML=n,o.id="error-"+e,o.appendChild(u),this.errorContainer.appendChild(o),defer(this,function(){o.style.opacity=1}),this.errorContainer["error-"+e]=o}this.errorContainer.style.opacity!=1&&(this.errorContainer.style.opacity=1)}}},numErrors:function(){return this.errorContainer.querySelectorAll("li:not(.hide)")},errorCheck:function(){var e=this.numErrors();
e.length>0?(this.errorContainer.parentNode.addClassName("visible"),this.errorContainer.style.opacity=1,e.each(bind(this,function(e){e.style.opacity=1;
var t=this.inputElement[e.className];
t&&t.addClassName("error")}))):(this.errorContainer.style.opacity=0,this.errorContainer.parentNode.removeClassName("visible"))},clearError:function(e,t){this.errorContainer&&(e.removeClassName("error"),e.id!=""&&t&&this.errorContainer["error-"+e.id]&&(this.errorContainer["error-"+e.id].addClassName("hide"),this.errorContainer["error-"+e.id].style.opacity=0),this.errorContainer.style.opacity=this.errorContainer.querySelectorAll("li:not(.hide)").length>0?1:0)},listenForEnterKey:function(e){var t=this;
e.id=="pass1"?(this.listen(e,"paste",function(){defer(this,function(){t.enableVerifyPassword(e)})},!1),this.listen(e,"keypress",function(n){t.enableVerifyPassword(e),n.keyCode==13&&(t.formCheck()||n.preventDefault())},!0)):this.listen(e,"keypress",function(e){e.keyCode==13&&(t.formCheck()||e.preventDefault())},!0)},formCheck:function(){var e=this;
if(!this.lookup)return!0;
var t=!1;
this.lookup.each(function(n){if(n.value==""||n.value=="WONoSelectionString")n.type!=="button"&&!n.ignore&&(t=!0,e.hasChanged(n,!0),e.throwError(n,!1));
else if(n.hasAttribute("pattern")&&this.userModified){var r=n.getAttribute("pattern"),i=n.value.match(r)?n.value.match(r)[0]:null;
if(!i||n.value!=i)t=!0,e.hasChanged(n,!0),e.throwError(n,!0)}});
if(t){var n=this.numErrors();
return n.length<1&&this.appendError("continue"),this.dispatchFormCheckEvent({status:!1}),!1}return this.clearError(this.continueButton,!0),this.dispatchFormCheckEvent({status:!0}),!0},dispatchFormCheckEvent:function(e){var t=document.createEvent("Events");
t.initEvent("iTSValidation.event.formCheckStatus",!0,!0),Class.extend(t,e),this.element.dispatchEvent(t)},ignoreCCValidation:function(){if(this.isEditBilling){var e=document.querySelector(".credit-card-picker input.selected"),t=e.hasClassName("cbxx"),n=e.hasClassName("none"),r=e.hasClassName("paypal");
if(n||r)r&&this.continueButton.hasClassName("disabled")?this.continueButton.removeClassName("disabled"):this.continueButton.addClassName("disabled"),this.lookup.each(function(e){r?e.ignore=!0:n&&e.id.match("cc_")?e.ignore=!0:t&&e.id.match("sms-otp")&&(e.ignore=!0)})}},restoreCCValidation:function(){this.lookup.each(function(e){e.ignore=!1})},enableVerifyPassword:function(e){e.value!=""?this.inputElement.pass2.disabled=!1:(this.inputElement.pass2.disabled=!0,this.inputElement.pass2.value="")},setHiddenValue:function(){var e=this;
this.inputElement&&this.inputs.each(function(t){t.type=="hidden"&&e.toValidate[t.id]&&e.doTheRinger(t)})}}}),its.kit.createController("DTMarketingOffers",{binding:"body.account section.edit-account.signup",component:{init:function(){this.updatedMarketing=!1,this.month=this.element.querySelector("select#birthMonthPopup"),this.day=this.element.querySelector("select#birthDayPopup"),this.year=this.element.querySelector("input#birthYear"),this.month!==null&&this.day!==null&&this.year!==null&&(this.listen(this.month,"change","changeEvent"),this.listen(this.day,"change","changeEvent"),this.listen(this.year,"input","changeEvent"))},changeEvent:function(e){this.checkBirthday(e.target)},inputEvent:function(e){this.checkBirthday(e.target)},checkBirthday:function(e){var t=this.month.options[this.month.selectedIndex].value,n=this.day.options[this.day.selectedIndex].value,r=this.year.value;
if(this.updatedMarketing===!1&&t!=="WONoSelectionString"&&n!=="WONoSelectionString"&&r!==null&&r!==""){t=parseInt(t),n=parseInt(n)+1,r=parseInt(r)+18;
if(!isNaN(r)&&r.toString().length===4){var i=new Date(its.currentTime()),s=new Date(r,t,n);
if(!isNaN(s)&&s>i){var o=this.element.querySelector("input#newsletter"),u=this.element.querySelector("input#marketing");
o!==null&&(o.checked=!1),u!==null&&(u.checked=!1),this.updatedMarketing=!0}}}}}}),its.kit.createController("iTSAccount",{binding:"body.account",controller:{openBubble:function(){this._components.each(function(e){e.openBubble()})},showDisclaimer:function(){this._components.each(function(e){e.showDisclaimer()})}},component:{showLog:!1,init:function(){this.showBubble=this.element.querySelector("a.show-bubble"),this.showBubble?(this.container=this.element.querySelector("div.bubble"),this.changeForm=this.container.querySelector("form"),this.countryList=this.element.querySelector("select#country"),this.listen(this.showBubble,"click","clickEvent",!0),this.listen(this.countryList,"change","clickEvent",!0)):this.element.querySelector("select#country")&&(this.container=this.element.querySelector("section.change-country"),this.changeForm=this.element.querySelector("form"),this.countryList=this.container.querySelector("select#country"),this.listen(this.countryList,"change","clickEvent",!0));
var e=this.element.querySelector("input.cancel"),t=this.element.querySelector("input.continue");
if((t||e)&&window.history.length<2){var n=this.element.querySelector("form"),r=document.createElement("input");
r.setAttribute("type","hidden"),r.setAttribute("name","no_history"),r.setAttribute("value","true"),n.appendChild(r)}},clickEvent:function(e){e.target==this.showBubble?(e.preventDefault(),e.stopPropagation(),this.openBubble()):e.target==this.countryList&&this.showDisclaimer()},openBubble:function(){this.container.style.display="block",this.container.style.height=this.container.scrollHeight+"px",this.container.style.opacity="1",this.showBubble.parentNode.style.display="none"},showDisclaimer:function(){var e=this.container.querySelector(".disclaimer");
e.nodeName==="P"?(e.style.display="block",this.container.style.height=this.container.scrollHeight+"px"):e.style.display="inline-block"}}}),its.kit.createController("iTSTerms",{binding:"body.account section.terms",component:{init:function(){this.pleaseReadParagraph=this.element.querySelector("p.please-read"),this.iagree=this.element.querySelector("#iagree"),this.continueButton=document.querySelector("a.continue, input#continue"),this.continueButtonElement=document.querySelector("a.continue button"),this.listen(this.iagree,"click","clickEvent",!0),this.continueButton&&this.listen(this.continueButton,"click","clickEvent",!0),this.iagree.checked&&this.iagreeClick();
if(its.client.screenReaderRunning()){this.listen(this.continueButton.parentNode,"click","clickEvent",!0);
var e=this.element.querySelector("div.terms-content");
e.style.height="auto",e.style.overflowY="visible"}},clickEvent:function(e){if(e.target==this.iagree)this.iagreeClick(e.target);
else if(e.target==this.continueButton||e.target.parentNode==this.continueButton)this.submitTerms(e);
else{var t=""+e.target.nodeName.toLowerCase();
e.target.id!=""&&(t+="#"+e.target.id),e.target.className!=""&&(t+="."+e.target.className),iTSAccount.showLog&&console.log("unexpected event "+e.type+" on "+t)}},iagreeClick:function(){this.iagree.checked?(this.errorO&&(this.errorO.addClassName("hide"),this.iagree.removeClassName("error"),this.pleaseReadParagraph.removeClassName("error")),this.continueButton.removeClassName("disabled"),this.continueButtonElement&&this.continueButtonElement.addClassName("emphasized"),this.continueButton.setAttribute("aria-disabled","false")):(this.continueButton.addClassName("disabled"),this.continueButtonElement&&this.continueButtonElement.removeClassName("emphasized"),this.continueButton.setAttribute("aria-disabled","true"))},submitTerms:function(e){if(!this.iagree.checked)return this.errorO?this.errorO.removeClassName("hide"):(this.errorO=document.createElement("div"),this.errorO.addClassName("error-o"),this.iagree.parentNode.insertBefore(this.errorO,this.iagree)),this.iagree.addClassName("error"),this.pleaseReadParagraph.addClassName("error"),e.preventDefault(),e.stopPropagation(),!1;
if(this.continueButton.type!="submit"){e.preventDefault(),e.stopPropagation();
var e=document.createEvent("Event");
e.initEvent("submit",!0,!0),this.iagree.form.dispatchEvent(e),e.returnValue&&this.iagree.form.submit()}}}}),its.kit.createController("iTSCreateAccount",{binding:"body.account section.edit-account",component:{init:function(){var e=this;
this.monthPopup=this.element.querySelector("#birthMonthPopup"),this.monthPopup&&(this.dayPopup=this.element.querySelector("#birthDayPopup"),this.listen(this.monthPopup,"change",function(){e.birthMonthChange()},!1),this.birthMonthChange())},birthMonthChange:function(){if(this.monthPopup.selectedIndex>0&&this.dayPopup.selectedIndex>0){var e=this.dayPopup.options[this.dayPopup.selectedIndex].innerHTML,t=[31,31,29,31,30,31,30,31,31,30,31,30,31][this.monthPopup.selectedIndex],n=this.dayPopup.options.length;
this.dayPopup.options.length=t+1;
for(var r=30;
r<=t;
r++)this.dayPopup.options[r]=document.createElement("option"),this.dayPopup.options[r].innerHTML=r,this.dayPopup.options[r].value=r-1,r==e&&(this.dayPopup.selectedIndex=r)}}}}),its.kit.createController("iTSBilling",{binding:"body.account section.edit-billing, body.account .prepaid-wrapper.edit-billing",component:{stateRange:"03899NH00599NY00799PR00899VI00999PR02799MA02999RI03899NH04999ME05499VT05599MA05999VT06389CT06390NY06999CT08999NJ09899AE14999NY19699PA19999DE20099DC20199VA20599DC21999MD24699VA26899WV28999NC29999SC31999GA33999FL34099AA34999FL36999AL38599TN39799MS39999GA42799KY45999OH47999IN49999MI52899IA54999WI56799MN57799SD58899ND59999MT62999IL65899MO67999KS69399NE71499LA72999AR73199OK73399TX74999OK79999TX81699CO83199WY83899ID84799UT86599AZ88499NM88599TX89899NV96199CA96699AP96797HI96799AS96899HI96999GU96940PW96944FM96952MP96970MH97999OR99499WA99999AK",init:function(){var e=this;
this.showBubble=this.element.querySelector("a.show-bubble"),this.ccSelectors=this.element.querySelectorAll("ul.credit-card-picker input"),this.ccContainer=this.element.querySelector(".formset.credit-card"),this.ccvHint=this.element.querySelector("div.hint"),this.continueButton=document.querySelector("input.continue"),this.postalCode=this.element.querySelector("#postalcode");
var t=this.element.querySelector(".country-name");
t&&(this.countryName=t.innerHTML),this.stateSel=this.element.querySelector("#state"),this.continueButton&&(this.continueText=this.continueButton.title,this.createAppleIDText=this.continueButton.value),this.ccvToggleHint=this.element.querySelector("a.toggle-hint"),this.billingInfo=this.element.querySelector("div.billing-information"),this.ccvToggleHint&&this.listen(this.ccvToggleHint,"click","clickEvent",!0),this.ccSelectors&&this.ccSelectors.each(bind(this,function(e){e.hasClassName("selected")&&this.pickCreditCard(e),this.listen(e,"click","clickEvent",!0)})),this.postalCode&&this.listen(this.postalCode,"blur","blurEvent",!0),this.ccNumber=this.element.querySelector("#cc_number"),this.ccNumber&&(this.listen(this.ccNumber,"keydown","keyPressEvent",!0),this.listen(this.ccNumber,"focus","focusEvent",!0),this.listen(this.ccNumber,"mouseup","focusEvent",!0)),this.taxId=this.element.querySelector("#taxId"),this.taxId&&(this.listen(this.taxId,"keydown","keyPressEvent",!0),this.listen(this.taxId,"focus","focusEvent",!0),this.listen(this.taxId,"mouseup","focusEvent",!0)),this.billingForm=document.querySelector("body.account.edit-address.signup form, body.account.edit-address.convert form, body.account.edit-address.edit form");
if(this.billingForm){this.billingForm.onsubmit=bind(this,this.handleSubmit);
var n=this.billingForm.querySelector("#machineGUID");
n&&iTunes.getMachineGUID&&(n.value=iTunes.getMachineGUID()),this.firstName=this.billingForm.querySelector("#firstName"),this.lastName=this.billingForm.querySelector("#lastName, #lastFirstName"),this.longName=this.billingForm.querySelector("#longName"),this.firstName&&this.lastName&&this.longName&&(this.firstName.addEventListener("blur",bind(this,this.nameChanged),!0),this.lastName.addEventListener("blur",bind(this,this.nameChanged),!0),this.billingForm.addEventListener("submit",this,!0))}},handleSubmit:function(e){this.nameChanged()},nameChanged:function(e){if(this.firstName&&this.lastName&&this.longName){var t=this.firstName.value,n=this.lastName.value;
this.firstName.hasClassName("required")?this.longName.value=n.substr(0,1).toUpperCase()+n.substr(1).toLowerCase()+","+t.substr(0,1).toUpperCase()+t.substr(1).toLowerCase():this.longName.value=t+n}},clickEvent:function(e){e.target==this.ccvToggleHint?(e.preventDefault(),e.stopPropagation(),this.toggleCCV()):e.target.name=="cc-type"?this.pickCreditCard(e.target):e.target.hasClassName("payment-not-supported")&&this.handleCreditCardNotSupportedEvent(e)},blurEvent:function(e){if(e.srcElement==this.postalCode)try{this.countryName.indexOf("United States")>-1&&this.stateSel.selectedIndex==0&&this.setStateFromZip(this.postalCode.value,this.stateSel)}catch(t){}},keyPressEvent:function(e){try{(e.srcElement==this.taxId||e.srcElement==this.ccNumber)&&e.keyCode!=13&&e.srcElement.hasClassName("masked")&&e.srcElement.removeClassName("masked")}catch(t){}},focusEvent:function(e){if(e.srcElement==this.ccNumber||e.srcElement==this.taxId)try{var t=e.srcElement;
t.hasClassName("masked")&&(e.srcElement.select(),e.preventDefault(),e.stopPropagation())}catch(n){}},getStateFromZip:function(e){if(e.length==5)for(var t=0;
t<this.stateRange.length;
t+=7)if(e<=1*this.stateRange.substr(t,5))return this.stateRange.substr(t+5,2);
return null},setStateFromZip:function(e,t){if(!e||!t)return;e=its.string.trim(e);
var n=e.length;
if(n<5)return;n>5&&(e=e.substring(0,5));
var r=this.getStateFromZip(e);
if(r){n=t.options.length;
for(var i=0;
i<n;
i++)if(t.options[i].text==r)return t.options[i].selected=!0}},toggleCCV:function(){this.ccvHint.style.display=="block"?this.closeCCV():this.openCCV()},closeCCV:function(){this.ccvHint.style.opacity="0",this.ccvToggleHint.removeClassName("close"),setTimeout(bind(this,function(){this.ccvHint.style.display="none"}),300)},openCCV:function(){this.ccvHint.style.display="block",defer(this,function(){this.ccvHint.style.opacity="1",this.ccvToggleHint.addClassName("close")});
var e=this;
this.listen(window,"click",function(){e.closeCCV()},!1)},pickCreditCard:function(e){this.ccSelectors.each(function(e){e.style.width=""}),e.parentNode.addClassName("selected")},handleCreditCardNotSupportedEvent:function(e){e.preventDefault(),e.stopPropagation(),this.ccSelectors.each(function(e){e.removeClassName("selected"),e.parentNode.removeClassName("selected")}),e.target.hasClassName("selected")||(e.target.addClassName("selected"),e.target.parentNode.addClassName("selected")),this.pickCreditCard(e.target),this.continueButton&&!this.continueButton.hasClassName("disabled")&&(this.continueButton.disabled=!0,this.continueButton.addClassName("disabled"),this.continueButton.setAttribute("aria-disabled","true")),this.billingInfo&&!this.billingInfo.hasClassName("payment-not-supported-selected")&&this.billingInfo.addClassName("payment-not-supported-selected")},changeBillingView:function(e){e=="paypal"?(this.billingInfo.removeClassName("none"),this.billingInfo.addClassName("paypal")):e=="none"&&(this.billingInfo.removeClassName("paypal"),this.billingInfo.addClassName("none"))}}}),its.kit.createController("iTSAccountSummary",{binding:"body.account section.account-summary",component:{init:function(){var e=this;
this.includeOnlyWrapper=this.element.querySelector("div.include-only-wrapper"),this.includeOnlyWrapper&&this.listen(this.includeOnlyWrapper,"iTSClientSideInclude.event.status","handleEvent",!0),this.doneButton=document.querySelector("button.done-button"),this.doneButton&&this.listen(this.doneButton,"click",function(){its.client.goBackOrGoHome()},!0),this.iTunesDisconnectButton=this.element.querySelector("#iTunesDisconnectButton"),this.iTunesDisconnectButton&&this.iTunesDisconnectButton.addEventListener("click",bind(this,this.showDisconnectConfirmDialog),!1),this.resetCloudButton=this.element.querySelector("#resetCloudButton"),this.resetCloudButton&&this.resetCloudButton.addEventListener("click",bind(this,this.showResetCloudConfirmDialog),!1),this.setUIForFamilyButtons()},setUIForFamilyButtons:function(){var e=this.element.querySelector("#familySettingsLink");
e&&(iTunes.launchICloudFamilySettings?e.addEventListener("click",function(e){e.preventDefault(),iTunes.launchICloudFamilySettings()},!1):e.style.display="none")},showDisconnectConfirmDialog:function(e){var t=its.loc("JS.DisconnectConfirm.Message"),n=its.loc("JS.DisconnectConfirm.Explanation");
return its.client.showConfirm(t,n,bind(this,"disconnectConfirm"),null,its.loc("OK"),its.loc("Cancel")),e.preventDefault(),e.stopPropagation(),!1},showResetCloudConfirmDialog:function(e){var t={message:its.loc("JS.ResetCloudConfirm.Message"),explanation:its.loc("JS.ResetCloudConfirm.Explanation"),checkboxString:its.loc("JS.ResetCloudConfirm.Checkbox"),initialCheckboxValue:!1,defaultButton:its.loc("JS.ResetCloudConfirm.ResetButton"),okButtonString:its.loc("JS.ResetCloudConfirm.ResetButton"),otherButtonString:its.loc("JS.ResetCloudConfirm.LearnMore"),cancelButtonString:its.loc("Cancel")},n={okButtonAction:bind(this,"showResetCloudConfirmDialog2"),cancelButtonAction:its.emptyFunction,otherButtonAction:bind(this,"learnMoreCloud")};
return its.client.showDialog(t,n),e.preventDefault(),e.stopPropagation(),!1},disconnectConfirm:function(){window.location.href=this.iTunesDisconnectButton.getAttribute("href")},showResetCloudConfirmDialog2:function(e){if(e&&e.checkboxValue===!0){var t=its.loc("JS.ResetCloudConfirm2.Message"),n=its.loc("JS.ResetCloudConfirm2.Explanation"),r=its.loc("JS.ResetCloudConfirm2.ResetButton");
its.client.showConfirm(t,n,bind(this,"resetCloudConfirm"),null,r,its.loc("Cancel"))}else this.showResetCloudConfirmDialog()},resetCloudConfirm:function(e){this.resetCloudButton&&(this.resetCloudButton.style.opacity="0.5",this.resetCloudButton.style.pointerEvents="none"),window.location.href=this.resetCloudButton.getAttribute("href")},learnMoreCloud:function(){var e=its.loc("JS.ResetCloudConfirm.LearnMore.Url");
iTunes.openURL(e)},handleEvent:function(e){var t=this;
if("iTSClientSideInclude.event.status"==e.type)switch(e.status){case"success":var n=this.includeOnlyWrapper.querySelector("div[client-side-include-url]");
n&&n.childElementCount>0&&(this.includeOnlyWrapper.style.display="block",defer(this,function(){t.includeOnlyWrapper.style.opacity=1}));
break;case"failed":break;case"timeout":}}}}),its.kit.createController("ITunesMatchAddComputer",{binding:"body.account section.account-summary div.row.add-computer",component:{init:function(){this.shouldShowAddComputerButton()?(this.addComputerButton=this.element.querySelector("#add-computer-button"),this.addComputerUrlTarget=this.addComputerButton.getAttribute("url-target"),this.addComputerUrl=its.url.appendUrlParameter(this.addComputerButton.getAttribute("url"),"guid",iTunes.getMachineGUID()),this.listen(this.addComputerButton,"click","clickEvent",!0)):this.element.hide()},clickEvent:function(e){e.target==this.addComputerButton&&this.addComputerButtonClickHandler(e)},shouldShowAddComputerButton:function(){var e=iTunes.getCloudState();
return e==ITunesMatchState.IN_STORE_FLOW||e==ITunesMatchState.OFF},addComputerButtonClickHandler:function(e){e.preventDefault();
var t=iTunes.getCloudState();
switch(t){case ITunesMatchState.IN_STORE_FLOW:case ITunesMatchState.OFF:window.open(this.addComputerUrl,this.addComputerUrlTarget)}}}});
var ITunesMatchState={UNKNOWN:0,IN_STORE_FLOW:1,OFF:2,ENROLL:3,ENROLLED:4,UPLOADING:5,UPLOAD_COMPLETED:6,RESET:7,START_GENIUS:8,GATHERING_DATA:9,SENDING_DATA:10,WAITING_FOR_RESULTS:11,IMPORTING_RESULTS:12,MATCHING:13,STOPPED:14};
its.kit.createController("iTSTopup",{binding:"body.account section.prepaid-addmoney",component:{init:function(){var e=this;
this.bankSelectors=this.element.querySelectorAll("#bankSelector span.bank-logo"),this.bankCardType=this.element.querySelector("input[name=bankCardType]"),this.bankSelectors&&this.bankSelectors.each(bind(this,function(e){e.hasClassName("selected")&&this.pickBank(e),this.listen(e,"click","handleEvent",!0),this.listen(e,"keypress","handleEvent",!0)}))},pickBank:function(e){this.bankSelectors.each(function(e){e.hasClassName("selected")&&e.removeClassName("selected"),e.setAttribute("aria-checked",!1)});
var t="";
e.tagName=="IMG"?(e.parentNode.addClassName("selected"),e.parentNode.setAttribute("aria-checked",!0),t=e.parentNode.id):(e.addClassName("selected"),e.setAttribute("aria-checked",!0),t=e.id),this.bankCardType.value=t,its.kit.sendToController("iTSValidation","setHiddenValue")},handleEvent:function(e){(e.type=="keypress"&&e.keyCode==13||e.type=="click")&&this.pickBank(e.target)}}}),its.kit.createController("iTSConfirmClick",{binding:"a[confirm-click]",component:{init:function(){this.flag=this.element.getAttribute("confirm-click"),this.listen(this.element,"click",clickEvent,!0)},clickEvent:function(e){var t=iTSKit.iTSValidationController.hasModified();
if(t){e.preventDefault(),e.stopPropagation();
var n={defaultButton:"ok",message:its.loc("JS.MZFinance.BillingInformation"),explanation:its.loc("JS.MZFinance.BillingInfoHasBeenModified"),okButtonString:its.loc("JS.MZFinance.OKButton")};
its.client.showDialog(n)}}}})